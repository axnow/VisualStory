<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Visual History Workbench</title>

    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/vis-history.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/timeline-graph.css">


    <script type="text/javascript" src="js/jquery/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/dashboard.js"></script>
</head>

<body>

<nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Visual History</a>
    <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
            <a class="nav-link" href="#">Sign out</a>
        </li>
    </ul>
</nav>

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">
                            <span data-feather="home"></span>
                            Dashboard <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file"></span>
                            Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="shopping-cart"></span>
                            Products
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="users"></span>
                            Customers
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="bar-chart-2"></span>
                            Reports
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="layers"></span>
                            Integrations
                        </a>
                    </li>
                </ul>

                <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Saved reports</span>
                    <a class="d-flex align-items-center text-muted" href="#">
                        <span data-feather="plus-circle"></span>
                    </a>
                </h6>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Current month
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Last quarter
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Social engagement
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <span data-feather="file-text"></span>
                            Year-end sale
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Dashboard</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group mr-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                        <span data-feather="calendar"></span>
                        This week
                    </button>
                </div>
            </div>
            <div class="my-4 w-100" style="height: 90%">
                <svg id="myChart" width="100%" height="100%" style="border-style: solid; border-color:black"></svg>
            </div>
            <h2>Text content</h2>
            <div id="entries"></div>
        </main>
    </div>
</div>

<script type="text/ecmascript">
    function refreshGraphSize() {
        width = $('#myChart').width();
        height = $('#myChart').height();
        console.log("Refreshig size, w=" + width + " h=" + height);
        updateRect();
        updateAxisLine();
    }


    //d3js
    $.getJSON("data/events.json", function (data) {
        console.info("Got json, has size: " + data.length);
        buildEventPars(data)
    });

    function eventText(event) {
        return event.date + ": " + event.name;
    }

    function buildEventPars(events) {
        // Update…
        var p = d3.select("#entries")
            .selectAll("p")
            .data(events)
            .text(function (d) {
                return eventText(d);
            });

// Enter…
        p.enter().append("p")
            .text(function (d) {
                return eventText(d);
            });

// Exit…


        p.exit().remove();
    }

    var rect = d3.select("#myChart").append("rect");

    function updateRect() {
        var rect = d3.select("#myChart").select("rect");
        rect.attr("width", width - 10);
        rect.attr("height", height - 10);
        rect.attr("x", 5);
        rect.attr("y", 5);
        rect.style("fill", "rgb(0,0,255)").style("stroke-width", "3").style("stroke", "rgb(255,0,0)").style("opacity", "0.05");
    }

    document.getElementById("myChart").addEventListener("click", function () {
        console.log("tick")
    });
    document.getElementById("myChart").addEventListener("show", function () {
        console.log("task")
    });
    // $('#myChart').resize(function() {console.log("afadsfasdfafda")})
    $(window).resize(refreshGraphSize);
    window.addEventListener("load", function () {
        console.log("Onload.");
        setTimeout(refreshGraphSize, 1000);
        // refreshGraphSize();
        setTimeout(initGraph, 1100);
    });


    var axisPosition = 120;

    function initGraph() {
        //add axis line
        d3.select("#myChart").append("line").classed("timeAxis", true).attr("id", "timeAxis");
        updateAxisLine();
        updateTimeAxisScale();
    }

    function updateTimeAxisScale() {
        console.log("Updating time scale")
        var scale = d3.scaleTime()
            .domain([new Date(1918, 0, 1), new Date(1939, 12, 31)])
            .range([height, 0]);

        //test code:
        var years = [];
        for (var y = 1918; y < 1940;y++) {
            years.push(y);
        }
        var yearsSelection = d3.select("#myChart").selectAll(".timeAxisTick").data(years);
        yearsSelection.enter()
            .append("circle")
            .attr("cx", axisPosition)
            .attr("cy", function (year) {
                return scale(new Date(year, 0, 1));
            })
            .attr("r", 4).classed("timeAxisTick");
        yearsSelection.exit().remove();

    }

    function updateAxisLine() {
        d3.select("#timeAxis")
            .attr("x1", axisPosition)
            .attr("y1", 0)
            .attr("x2", axisPosition)
            .attr("y2", height);
    }


</script>


</body>
</html>